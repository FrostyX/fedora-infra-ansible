- name: Create worker namespace
  hosts: osbs-masters-stg[0]
  tags:
    - osbs-worker-namespace
  user: root
  roles:
    - role: osbs-namespace
      osbs_namespace: "{{ osbs_worker_namespace }}"
      osbs_service_accounts: "{{ osbs_worker_service_accounts }}"
      osbs_nodeselector: "{{ osbs_worker_default_nodeselector|default('') }}"
      osbs_authoritative_registry: "{{ source_registry }}"
      osbs_sources_command: "{{ osbs_conf_sources_command }}"
      osbs_vendor: "{{ osbs_conf_vendor }}"

- name: setup koji secret in worker namespace
  hosts: osbs-masters-stg[0]
  tags:
    - osbs-worker-namespace
  roles:
  - role: osbs-secret
    osbs_namespace: "{{ osbs_worker_namespace }}"
    osbs_secret_name: kojisecret
    osbs_secret_files:
    - source: "/etc/pki/koji/fedora-builder.pem"
      dest: cert

- name: setup dist registry secret in worker namespace
  hosts: osbs-masters-stg[0]
  tags:
    - osbs-worker-namespace
  roles:
  - role: osbs-secret
    osbs_namespace: "{{ osbs_worker_namespace }}"
    osbs_secret_name: registry-secret
    osbs_secret_files:
    - source: "{{private}}/files/koji/{{docker_cert_name}}.cert.pem"
      dest: registry.crt
    - source: "{{private}}/files/koji/{{docker_cert_name}}.key.pem"
      dest: registry.key
