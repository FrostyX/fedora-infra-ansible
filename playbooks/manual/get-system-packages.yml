#
# A playbook to get all the rpms installed on a set of systems. 
# 

- name: Get installed packages
  hosts: builders:releng-compose:data-analysis01.phx2.fedoraproject.org
  gather_facts: true
  user: root

  tasks:

  - name: yum_command 
    yum: list=installed
    register: yum_packages
    when: ansible_distribution == "RedHat" and ansible_distribution_major_version|int <= 7

  - name: dnf_command
    dnf: list=installed
    register: dnf_packages
    when: ansible_distribution == "Fedora" and ansible_distribution_major_version|int > 21

  - name: dnf_command
    dnf: list=installed
    register: dnf_packages
    when: ansible_distribution == "RedHat" and ansible_distribution_major_version|int > 8

#  - debug: msg="{{ inventory_hostname}} {{ yum_packages.results }}"
#    when: yum_packages is defined and yum_packages.results|length > 0

  - debug: msg="{{ item.envra }}"
    with_items: "{{ yum_packages.results }}"
    when: yum_packages is defined and yum_packages.results|length > 0

  - debug: msg="{{ item }}"
    with_items: "{{ dnf_packages.results }}"
    when: dnf_packages is defined and dnf_packages.results|length > 0

#
#
