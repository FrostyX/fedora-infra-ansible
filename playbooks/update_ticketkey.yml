- name: Create and push out new ticket key
  hosts: proxies:proxies-stg
  user: root

  handlers:
  - include: "{{ handlers }}/restart_services.yml"

  tasks:
  - name: create new production ticket key
    command: dd if=/dev/random of=/root/ticketkey_production.tkey bs=1 count=48
    connection: local

  - name: create new staging ticket key
    command: dd if=/dev/random of=/root/ticketkey_staging.tkey bs=1 count=48
    connection: local

  - name: deploy ticket key
    copy: src=/root/ticketkey_{{env}}.tkey dest=/etc/httpd/ticketkey_{{env}}.tkey
          owner=root group=root mode=0600
    notify:
    - restart httpd
