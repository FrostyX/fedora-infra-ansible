- name: Set up those proxy websites.  My, my..
  hosts: proxies-stg
  user: root
  gather_facts: True

  vars_files:
   - /srv/web/infra/ansible/vars/global.yml
   - "{{ private }}/vars.yml"
   - /srv/web/infra/ansible/vars/{{ ansible_distribution }}.yml

  handlers:
  - include: "{{ handlers }}/restart_services.yml"

  vars:
  - ssl: true
  - SSLCertificateChainFile: wildcard-2014.fedoraproject.org.intermediate.cert

  # wildcard_cert_name is defined in group_vars

  roles:

  - role: httpd/website
    name: fedoraproject.org
    server_aliases: [stg.fedoraproject.org]
    cert_name: {{wildcard_cert_name}}

  - role: httpd/website
    name: admin.fedoraproject.org
    server_aliases: [admin.stg.fedoraproject.org]
    cert_name: {{wildcard_cert_name}}
    sslonly: true
