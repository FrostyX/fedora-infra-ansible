---
# OpenVpn server

- name: Install needed packages
  yum: pkg={{ item }} state=installed
  with_items:
  - openvpn
  tags:
  - packages

- name: Install configuration files
  file: src={{ item.file }}
        dest={{ item.location }}/{{ item.dest }}
        owner=root group=root mode={{ mode }}
  with_items:
  - { file: client.conf,
      dest: /etc/openvpn/openvpn.conf,
      mode: 0644 }
  - { file: {{ puppet_private }}/vpn/openvpn/keys/client.crt,
      dest: /etc/openvpn/{{ inventory_hostname }}.crt,
      mode: 0644 }
  - { file: {{ puppet_private }}/vpn/openvpn/keys/client.key,
      dest: /etc/openvpn/{{ inventory_hostname }}.key,
      mode: 0600 }
  tags:
  - install
  notify:
  - restart openvpn {{ ansible_distribution_version[0] }}

- name: enable openvpn service for rhel 6 or Fedora
  service: name=openvpn state=running enabled=true
  when: ansible_distribution_version[0] == 6 or is_fedora is defined
  tags:
  - service

- name: enable openvpn service for rhel 7
  service: name=openvpn@openvpn state=running enabled=true
  when: ansible_distribution_version[0] == 7
  tags:
  - service

