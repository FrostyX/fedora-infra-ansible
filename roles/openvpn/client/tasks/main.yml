---
# OpenVpn server

- name: Install needed packages
  yum: pkg={{ item }} state=installed
  with_items:
  - openvpn
  tags:
  - packages

- name: Install configuration files
  file: src={{ item.file }}
        dest={{ item.location }}/{{ item.dest }}
        owner=root group=root mode={{ mode }}
  with_items:
  - { file: client.conf,
      dest: /etc/openvpn/openvpn.conf,
      mode: 0644 }
  - { file: {{ puppet_private }}/vpn/openvpn/keys/client.crt,
      dest: /etc/openvpn/{{ inventory_hostname }}.crt,
      mode: 0644 }
  - { file: {{ puppet_private }}/vpn/openvpn/keys/client.key,
      dest: /etc/openvpn/{{ inventory_hostname }}.key,
      mode: 0600 }
  tags:
  - install
  notify:
  - restart openvpn {{ ansible_distribution_version[0] }}

