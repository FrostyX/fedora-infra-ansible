---
- name: Get nfs-utils
  yum: pkg=nfs-utils state=installed

- name: Create /srv/pub directory
  file: path=/srv/pub state=directory

- name: Get libsemanage-python
  yum: pkg=libsemanage-python state=installed

- name: Set httpd_use_nfs seboolean
  action: seboolean name=httpd_use_nfs state=yes persistent=yes

- name: /var/log/rsyncd-fedora.log file context
  command: semanage fcontext -a -t rsync_log_t "/var/log/rsyncd-fedora.log"

- name: /etc/system_identification
  copy: src=system_identification dest=/etc/system_identification

- name: /etc/motd_fedora
  copy: src=motd_fedora dest=/etc/motd_fedora

- name: Configure logrotate for /var/log/rsyncd-fedora.log
  copy: src=logrotate-rsync-fedora dest=/etc/logrotate.d/rsync-fedora

- name: NFS mount points (phx2)
  mount: name=/srv/pub src=vtap-fedora-nfs01.storage.phx2.redhat.com:/vol/fedora_ftp/fedora.redhat.com/pub fstype=nfs opts=defaults,fsc,ro,noatime,nodev,nosuid,hard,intr,nfsvers=3,nocto,actimeo=600 state=mounted
  when: datacenter == 'phx2'

- name: /srv/pub file contexts
  command: semanage fcontext -a -t httpd_sys_content_t "/srv/pub(/.*)?"

- name: NFS mount points (rdu)
  mount: name=/srv/pub src=172.31.1.10:/vol/fedora_ftp/fedora.redhat.com/pub fstype=nfs opts=defaults,ro,noatime,nodev,nosuid,hard,intr,nfsvers=3 state=mounted
  when: datacenter == 'rdu'

- name: Copy wildcard cert from puppet private
  copy: src="{{puppet_private}}/httpd/wildcard-2014.fedoraproject.org.cert" dest=/etc/pki/tls/wildcard-2014.fedoraproject.org.cert owner=root group=root mode=0600

- name: Copy wildcard key from puppet private
  copy: src="{{puppet_private}}/httpd/wildcard-2014.fedoraproject.org.key" dest=/etc/pki/tls/wildcard-2014.fedoraproject.org.key owner=root group=root mode=0600

- name: Copy intermediate wildcard cert from puppet private
  copy: src="{{puppet_private}}/httpd/wildcard-2014.fedoraproject.org.intermediate.cert" dest=/etc/pki/tls/wildcard-2014.fedoraproject.org.intermediate.cert owner=root group=root mode=0600

- name: Configure httpd
  copy: src=httpd/ dest=/etc/httpd/conf.d/
