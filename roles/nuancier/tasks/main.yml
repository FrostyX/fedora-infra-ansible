---
# Configuration for the nuancier webapp

- name: install needed packages
  yum: pkg=$item state=installed
  with_items:
  - nuancier-lite
  tags:
  - packages

- name: copy sundry nuancier configuration
  template: >
    src={{ item.file }} dest={{ item.location }}/{{ item.dest }}
    owner=apache group=apache mode=0600
  with_items:
  - { file: nuancier_admin.cfg, location: /etc/nuancier, dest:nuancier.cfg }
  - { file: nuancier.conf, location: /etc/httpd/conf.d, dest: nuancier.conf }
  - { file: nuancier.wsgi, location: /usr/share/nuancier, dest: nuancier.wsgi }
  tags:
  - config
  notify:
  - restart apache

- name: create pictures folder where we upload the pictures
  action: file state=directory path=/var/www/nuancier/pictures
  tags:
  - setup

- name: create the cache folder where nuancier creates the thumbnails
  action: file state=directory path=/var/www/nuancier/cache
      owner=apache group=apache
  tags:
  - setup

- name: create the database scheme
  command: NUANCIER_CONFIG=/etc/nuancier/nuancier.cfg /usr/share/nuancier/nuancier-lite_createdb.py

- name: replace the nuancier configuration file by the one with the normal user
  template: >
    src={{ item.file }} dest={{ item.location }}/{{ item.dest }}
    owner=apache group=apache mode=0600
  with_items:
  - { file: nuancier.cfg, location: /etc/nuancier, dest:nuancier.cfg }
  tags:
  - config
  notify:
  - restart apache

