# Set up the script aliases
ScriptAlias /nagios/cgi-bin/ /usr/lib64/nagios/cgi-bin/
ScriptAlias /tac.cgi         /usr/lib64/nagios/cgi-bin/tac.cgi

# Set up the authorization

<Location /nagios>
  AuthName "Nagios GSSAPI Login"
{% if vars['nagios_location'] == 'internal' %}
  GssapiCredStore keytab:/etc/krb5.HTTP_nagios{{env_suffix}}.fedoraproject.org.keytab
  # This is off because Apache (and thus mod_auth_gssapi) doesn't know this is proxied over TLS
  GssapiSSLonly Off
{% else %}
  GssapiCredStore keytab:/etc/krb5.HTTP_nagios-external{{env_suffix}}.fedoraproject.org.keytab
  GssapiSSLonly On
{% endif %}
  GssapiLocalName on
  AuthType GSSAPI
  Require valid-user
</Location>

<Location ~ "/nagios/cgi-bin/">
  Options ExecCGI
</Location>

{% if vars['nagios_location'] == 'internal' %}
RewriteEngine on
RewriteRule ^/$ /nagios/ [R]
{% endif %}

Alias /nagios /usr/share/nagios/html/
<Directory "/usr/share/nagios/html">
  Options None
</Directory>
