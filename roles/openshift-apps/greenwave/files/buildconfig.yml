apiVersion: v1
kind: BuildConfig
metadata:
  name: "greenwave-docker-build"
  labels:
    environment: "greenwave"
spec:
  runPolicy: Serial
  source:
    dockerfile: |-
      FROM fedora:26
      LABEL \
          name="Greenwave" \
          vendor="Fedora Infrastructure" \
          license="MIT"
      RUN yum -y install --setopt=tsflags=nodocs \
          git \
          python-gunicorn \
          python-requests \
          python2-flask
      RUN git clone https://pagure.io/greenwave.git /srv/greenwave
      RUN ln -s /etc/greenwave/settings.py /srv/greenwave/conf/settings.py
      #RUN mv modern_paste.wsgi modern_paste_wsgi.py
      WORKDIR /srv/greenwave
      USER 1001
      EXPOSE 8080
      ENTRYPOINT python run-dev-server.py
      #ENTRYPOINT gunicorn --bind 0.0.0.0:8080 --access-logfile=- --chdir /usr/share/modern-paste modern_paste_wsgi:application
  strategy:
    type: Docker
  output:
    to:
      kind: ImageStreamTag
      name: greenwave:latest
