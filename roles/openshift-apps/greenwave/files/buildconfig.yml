apiVersion: v1
kind: BuildConfig
metadata:
  name: "greenwave-docker-build"
  labels:
    environment: "greenwave"
spec:
  runPolicy: Serial
  source:
    dockerfile: |-
      FROM fedora:25
      LABEL \
          name="Greenwave" \
          vendor="Fedora Infrastructure" \
          license="MIT"
      RUN yum -y install --setopt=tsflags=nodocs \
          git \
          python-gunicorn \
          python-requests \
          PyYAML \
          python2-flask
      RUN git clone https://pagure.io/greenwave.git /srv/greenwave
      RUN ln -s /etc/greenwave/settings.py /srv/greenwave/conf/settings.py
      RUN mkdir -p /etc/greenwave/policies/
      RUN ln -s /srv/greenwave/conf/policies/fedora.yaml /etc/greenwave/policies/fedora.yaml
      WORKDIR /srv/greenwave
      EXPOSE 8080
      ENTRYPOINT gunicorn --bind 0.0.0.0:8080 --access-logfile=- greenwave.wsgi:app
  strategy:
    type: Docker
  output:
    to:
      kind: ImageStreamTag
      name: greenwave:latest
