apiVersion: v1
kind: BuildConfig
metadata:
  name: monitor-gating-build
  labels:
    environment: "monitor-gating"
spec:
  source:
    git:
{% if env == 'staging' %}
      uri: https://pagure.io/forks/pingou/fedora-ci/monitor-gating.git
      ref: "staging"
{% else %}
      uri: https://pagure.io/fedora-ci/monitor-gating/.git
      ref: "production"
{% endif %}
  strategy:
    type: Docker
  template:
    metadata:
      labels:
        app: monitor-gating
        deploymentconfig: monitor-gating
    spec:
      containers:
      - name: monitor-gating
        image: monitor-gating:latest
        resources: {}
        volumeMounts:
        - name: monitor-gating-secret-volume
          mountPath: /config/
          readOnly: true
        - name: monitor-gating-ssh-volume
          mountPath: /root/.ssh/
          readOnly: true
      volumes:
       - name: monitor-gating-secret-volume
         secret:
           secretName: monitor-gating-secret
       - name: monitor-gating-ssh-volume
         secret:
           secretName: monitor-gating-ssh

  triggers:
  - type: ConfigChange
  - type: ImageChange
  output:
    to:
      kind: ImageStreamTag
      name: monitor-gating:latest
