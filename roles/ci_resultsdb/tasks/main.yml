---
- name: install ci_resultsdb's
  package: name={{ item }} state=present
  with_items:
    - python-ci-resultsdb-listener
    - libsemanage-python
    - rdbsync

- name: install fedmsg ca.cert
  copy: >
    src="{{ private }}/files/fedmsg-certs/keys/ca.crt"
    dest=/etc/pki/fedmsg/ca.crt
    owner=root
    group=root
    mode=0644
  tags:
  - config

- name: generate ci-resultsdb config
  template: src=ci-resultsdb-listener.py
        dest=/etc/fedmsg.d/ci-resultsdb-listener.py
        owner=root group=root mode=0644
  notify:
    - reload httpd

- name: Start and enable the fedmsg-hub service
  service: name={{ item }} enabled=yes state=started
  with_items:
  - fedmsg-hub
