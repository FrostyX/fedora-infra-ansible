- name: install nrpe checks
  template: src=copr_backend_nrpe.cfg dest=/etc/nrpe.d/copr_backend_nrpe.cfg
  notify:
  - restart nrpe
  tags:
  - nagios_client

# Three tasks for handling our custom selinux module
- name: ensure a directory exists for our custom selinux module
  file: dest=/usr/local/share/copr state=directory

- name: copy over our custom selinux module
  copy: src=selinux/nrpe_copr.pp dest=/usr/local/share/copr/fedmsg.pp
  register: selinux_module

- name: install our custom selinux module
  command: semodule -i /usr/local/share/copr/fedmsg.pp
  when: selinux_module|changed
