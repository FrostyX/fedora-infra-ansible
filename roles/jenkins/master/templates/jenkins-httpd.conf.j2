<VirtualHost *:80>
  ServerName jenkins.fedorainfracloud.org
  ServerAdmin webmaster@fedoraproject.org
  TraceEnable Off

  RewriteEngine on
  RewriteRule ^/\.well-known/(.*) /srv/web/acme-challenge/.well-known/$1 [L]
  RewriteCond %{HTTPS} off
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [NE]

</VirtualHost>

<VirtualHost *:443>
  ServerName jenkins.fedorainfracloud.org
  ServerAdmin webmaster@fedoraproject.org

  SSLEngine on
  SSLCertificateFile /etc/pki/tls/certs/jenkins.fedorainfracloud.org.cert
  SSLCertificateKeyFile /etc/pki/tls/private/jenkins.fedorainfracloud.org.key
  SSLCertificateChainFile /etc/pki/tls/certs/jenkins.fedorainfracloud.org.chain
  SSLHonorCipherOrder On

  # https://fedorahosted.org/fedora-infrastructure/ticket/4101#comment:14
  # If you change the protocols or cipher suites, you should probably update
  # modules/squid/files/squid.conf-el6 too, to keep it in sync.
  SSLProtocol {{ ssl_protocols }}
  SSLCipherSuite {{ ssl_ciphers }}

  Redirect / https://jenkins-fedora-infra.apps.ci.centos.org/
</VirtualHost>
