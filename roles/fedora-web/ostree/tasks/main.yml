- name: Copy ostree config file
  copy: src=ostree.conf dest=/etc/httpd/conf.d/ostree.fedoraproject.org/ostree.conf
  notify:
  - reload proxyhttpd
  tags:
  - fedora-web
  - ostree

- name: make ostree dir
  file: state=directory
        path=/srv/web/ostree
        owner=apache
        group=sysadmin-releng
        mode=2775
        setype=httpd_sys_content_t
        seuser=system_u
  tags:
  - fedora-web
  - ostree

- name: make ostree variant dirs
  file: state=directory
        path=/srv/web/ostree/{{ item }}
        owner=apache
        group=sysadmin-releng
        mode=2775
        setype=httpd_sys_content_t
        seuser=system_u
  with_items:
  - atomichost
  - coreos
  - silverblue
  - iot
  tags:
  - fedora-web
  - ostree

- name: Copy over the mirrorlist file
  copy: src=mirrorlist dest=/srv/web/ostree/{{item}}/mirrorlist mode=0644
  with_items:
  - atomichost
  - coreos
  - silverblue
  - iot
  tags:
  - fedora-web
  - ostree

- name: Copy over the config file
  copy: src=config dest=/srv/web/ostree/{{item}}/config mode=0644
  with_items:
  - atomichost
  - coreos
  - silverblue
  - iot
  tags:
  - fedora-web
  - ostree

- name: Copy in the sync-summary cron job
  copy: src=cron-sync-ostree-summary dest=/etc/cron.d/sync-ostree-summary
  tags:
  - fedora-web
  - ostree
