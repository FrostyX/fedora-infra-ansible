---
# Configuration for IPA

- name: install needed packages
  yum: pkg={{ item }} state=present update_cache=yes
  with_items:
  - haveged
  - ipa-server
  - ipa-server-dns
  tags:
  - ipa
  - packages

- name: enable haveged
  service: name=haveged state=started enabled=yes
  tags:
  - haveged
  - config

- name: install IPA
  command: ipa-server-install
           --realm={{ipa_realm}}
           --domain={{ipa_realm}}
           --ds-password={{ipa_dm_password}}
           --admin-password={{ipa_admin_password}}
           --mkhomedir
           --no-ntp
           --unattended
           --no-ssh
           --no-sshd
           --setup-dns
           --forwarder=10.5.126.21
           --forwarder=10.5.126.22
           --log-file=/var/log/ipainstall.log
           creates=/etc/ipa/default.conf
  tags:
  - ipa
  - config

- name: mask kadmin
  systemd: name=kadmin.service
           state=stopped
           enabled=no
           masked=yes
  tags:
  - ipa
  - config
