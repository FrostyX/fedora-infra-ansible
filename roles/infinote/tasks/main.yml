#
# This role sets up the various packages and scripts needed for a infinote server
#



#
# make directory for nfs mounts to live in
#

- name: create an infinoted user
  user: name=infinote state=present home=/home/infinote createhome=yes shell=/sbin/nologin
  tags:
  - infinote
  - config

- name: allow infinote user to read ssl certs
  file: dest=/etc/pki/tls/private/wildcard-2014.fedoraproject.org.key mode=600 owner=infinote group=root
  tags:
  - infinote
  - config

- name: create /srv/web for web content
  file: dest=/srv/web state=directory mode=755 owner=infinote group=infinote
  tags:
  - infinote
  - config

- name: create /srv/infinote for infinote content
  file: dest=/srv/infinote state=directory mode=755 owner=infinote group=infinote
  tags:
  - infinote
  - config

- name: install packages needed
  yum: pkg={{ item }} state=present
  with_items:
  - infinoted
  tags:
  - infinote
  - config

- name: add systemd unit file to start infinote daemon
  copy: src=infinoted.service dest=/etc/systemd/system/infinoted.service
  notify: reload systemd
  tags:
  - infinote
  - config

- name: enable infinoted 
  action: service name=infinoted state=running enabled=true
  tags:
  - infinote
  - config
  
- name: add config file for infinoted
  template: src=infinoted.conf dest=/etc/xdg/infinoted.conf
  tags:
  - infinote
  - config
  
- name: add git commit script for infinote
  template: src=infinoted-git-commit dest=/usr/local/bin/infinoted-git-commit mode=0755
  tags:
  - infinote
  - config
