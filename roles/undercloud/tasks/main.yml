---
- name: Install undercloud repo file
  copy: src="{{ files }}/newcloud/rhos13.repo" dest=/etc/yum.repos.d/rhos13.repo
  tags:
  - config
  - packages
  - yumrepos
  - undercloud

- name: Install packages
  package: name={{ item }} state=present
  with_items:
  - subscription-manager-rhsm-certificates
  - python-tripleoclient
  tags:
  - packages
  - undercloud

- name: Create stack user
  user: name=stack comment="openstack user" home=/home/stack
  tags:
  - config
  - users
  - undercloud

- name: Create templates directory
  file: path=/home/stack/templates state=directory owner=stack group=stack mode=0755
  tags:
  - config
  - undercloud

- name: Copy files to ~/stack/
  copy: src={{item}} dest=/home/stack/{{item}} owner=stack group=stack mode=0644
  with_items:
  - undercloud.conf
  - templates/node-info.yaml
  - openstack-overcloud-deploy.sh
  - configure-federation
  tags:
  - config
  - undercloud

- name: Copy files to ~/stack/templates/
  copy: src={{item}} dest=/home/stack/templates/{{item}} owner=stack group=stack mode=0644
  with_items:
  - cinder-dellps-config.yaml
  - environment-rhel-registration.yaml
  tags:
  - config
  - undercloud

- name: Copy nodes.json
  template: src=nodes.json dest=/home/stack/nodes.json owner=stack group=stack mode=0644
  tags:
  - config
  - undercloud
  - nodes

- name: Copy fed_variables
  template: src=fed_variables dest=/home/stack/fed_variables owner=stack group=stack mode=0644
  tags:
  - config
  - undercloud
