Alias /artifacts {{ public_artifacts_dir }}


<Directory "{{ public_artifacts_dir }}">
    Options +Indexes
    IndexOptions +NameWidth=*
    IndexOptions FancyIndexing
    IndexOrderDefault Descending Name
    AllowOverride None
    Require all granted
</Directory>


<Directory "{{ public_artifacts_dir }}/all">
    Options -Indexes
</Directory>


<DirectoryMatch "^{{ public_artifacts_dir }}/all/(.+)/">
    Options +Indexes
    IndexOptions +NameWidth=*
    AllowOverride None
    Require all granted
</DirectoryMatch>

{% if deployment_type == 'dev' %}
<DirectoryMatch "^{{ public_artifacts_dir }}/all/(.+)/task_output/">
    RewriteEngine on

    RewriteCond   "{{ public_artifacts_dir }}/all/$1/task_output/$2.gz"  -f
    RewriteCond   "{{ public_artifacts_dir }}/all/$1/task_output/$2"     !-f
    RewriteRule   "^{{ public_artifacts_dir }}/all/(.+)/task_output/(.*)$"  "{{ public_artifacts_dir }}/all/$1/task_output/$2.gz"
    SetOutputFilter INFLATE
    ForceType text/plain
</DirectoryMatch>
{% endif %}
