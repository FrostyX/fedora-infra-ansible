---
{% if deployment_type in ['dev', 'stg'] %}
- when: {message_type: KojiBuildPackageCompleted}
  do:
    - {tasks: [rpmlint, rpmgrill, python-versions]}
    - {discover: {repo: '{{ trigger_distgit_repo_url }}/test-rpms/${name}.git', branch: "${distgit_branch}", fallback_branch: 'master'}}
{% else %}
- when: {message_type: KojiBuildPackageCompleted}
  do:
    - {tasks: [rpmlint, rpmgrill, python-versions]}
{% endif %}
- when: {message_type: KojiBuildDockerCompleted}
  do:
    - {tasks: [simpledocker]}
- when: {message_type: KojiBuildPackageCompleted, name: docker}
  do:
    - {tasks: [dockerautotest]}
- when:
    message_type: KojiBuildPackageCompleted
    name:
{% if deployment_type in ['stg', 'prod'] %}
      $in: ${critpath_pkgs}
{% endif %}
      $nin: [firefox,thunderbird,kernel,kdelibs,kdepim,qt,mariadb,java-1.8.0-openjdk,libreoffice]
  do:
    - {tasks: [abicheck]}
- when: {message_type: KojiTagChanged}
  do:
{% if deployment_type in ['dev', 'stg'] %}
    - {tasks: [depcheck, rpmdeplint]}
{% else %}
    - {tasks: [depcheck]}
{% endif %}
- when:
    message_type: KojiTagChanged
    tag: {$regex: '/.*(?<!testing-pending)$$/'}
  do:
    - {tasks: [upgradepath]}
{% if deployment_type in ['dev'] %}
- when: {message_type: DistGitCommit, namespace: modules}
  do:
    - {tasks: [check_modulemd]}

# trigger off of scratch builds in dev
- when: {message_type: KojiTaskCompleted}
  do:
    - {discover: {repo: '{{ trigger_distgit_repo_url }}/rpms/${name}.git', branch: "${distgit_branch}", fallback_branch: 'master'}}
    - {tasks: [rpmlint-scratch]}
{% endif %}
