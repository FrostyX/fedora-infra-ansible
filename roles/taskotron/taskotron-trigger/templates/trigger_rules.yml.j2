---
- when: {message_type: KojiBuildPackageCompleted}
  do:
    - {tasks: [rpmlint, rpmgrill, python-versions]}
    - {discover: {repo: '{{ trigger_distgit_repo_url }}/rpms/${name}{{'.git' if deployment_type in ['stg'] else ''}}', branch: "${distgit_branch}", fallback_branch: 'master', recursive: true}}

- when: {message_type: KojiBuildPackageCompleted, name: docker}
  do:
    - {tasks: [dockerautotest]}

- when:
    message_type: KojiBuildPackageCompleted
    name:
      $nin: [{{ trigger_abicheck_blacklist | join(',') }}]
  do:
    - {tasks: [abicheck]}

- when:
    message_type: KojiTagChanged
    tag: {$regex: '/^f[0-9]{2}-updates(-testing)?-pending$$/'}
  do:
    - {tasks: [rpmdeplint]}

- when: {message_type: DistGitCommit, namespace: modules}
  do:
    - {tasks: [check_modulemd]}

- when:
    message_type: ModuleBuildComplete
  do:
    - {tasks: [modularity-testing-framework]}

- when:
    message_type: GitHubPullRequestOpened
    repo_name: {$regex: '/^container-images\/.+/'}
  do:
    - {tasks: [mtf-containers]}

{# disabled due to missing nested virt: https://pagure.io/taskotron/issue/239
- when:
    message_type: AtomicCompose
  do:
    - {tasks: [upstream-atomic, fedora-cloud-tests]}

- when:
    message_type: CloudCompose
  do:
    - {tasks: [fedora-cloud-tests]}
#}

