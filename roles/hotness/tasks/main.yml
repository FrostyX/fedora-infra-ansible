---
# Configuration for the the-new-hotness consumer

- name: install needed packages
  yum: pkg={{ item }} state=present
  with_items:
  - the-new-hotness
  - python-psycopg2
  - python-sh
  - koji
  tags:
  - packages
  - hotness

- name: copy database configuration
  template: >
    src={{ item }} dest=/etc/fedmsg.d/{{ item }}
    owner=fedmsg group=fedmsg mode=0600
  with_items:
  - hotness.py
  notify:
  - restart fedmsg-hub
  tags:
  - config
  - hotness

- name: install hotness.pem koji key and cert
  copy: >
    src="{{ puppet_private }}/hotness_key_and_cert.pem"
    dest="/etc/pki/fedmsg/hotness.pem"
    owner=fedmsg
    group=fedmsg
    mode=0400
  tags:
  - config
  - hotness

- name: install koji ca cert
  copy: >
    src="{{ puppet_private }}/fedora-ca.cert"
    dest="/etc/pki/fedmsg/{{ item }}"
    owner=root
    group=root
    mode=0644
  with_items:
  - fedora-server-ca.cert
  - fedora-upload-ca.cert
  tags:
  - config
  - hotness

- name: Create /usr/share/fedmsg (for bugzilla cookies...)
  file: dest=/usr/share/fedmsg owner=fedmsg group=fedmsg mode=0750 state=directory
  tags:
  - hotness
