---
- name: setup the copr repo
  copy: >
    src="codeblock-modern-paste-fedora-24.repo"
    dest="/etc/yum.repos.d/modern-paste.repo"
    owner=root
    group=root
    mode=0644
  tags:
  - config
  - modernpaste
  - repo
  - packages

- name: install needed packages
  package: pkg={{ item }} state=present
  with_items:
  - python-psycopg2
  - httpd
  - mod_wsgi
  - modern-paste
  tags:
  - packages
  - modernpaste

- name: modernpaste config
  template: src=config.py dest=/etc/modern-paste/config.py owner=apache group=apache mode=600
  tags:
  - config
  - modernpaste
  notify: reload httpd

- name: modernpaste flask config
  template: src=flask_config.py dest=/etc/modern-paste/flask_config.py owner=apache group=apache mode=600
  tags:
  - config
  - modernpaste
  notify: reload httpd

- name: set sebooleans so paste can talk to the db
  seboolean: name=httpd_can_network_connect_db state=true persistent=true
  tags:
  - config
  - selinux
  - modernpaste

- name: startup apache
  service: name=httpd enabled=yes state=started
  tags:
  - modernpaste
