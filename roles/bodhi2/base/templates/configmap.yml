---
apiVersion: v1
kind: ConfigMap
metadata:
  name: bodhi-configmap
  labels:
    app: bodhi
data:
  production.ini: |-
    {%- macro production_ini() %}    {% include "production.ini.j2" %}{%- endmacro -%}
    {{ production_ini() | indent() }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: fedmsg-configmap
  labels:
    app: bodhi
data:
  bodhi.py: |-
    import socket
    config = {
        'sign_messages': True,
        'active': True,
        'cert_prefix': 'bodhi',
        'certnames': {'bodhi.{}'.format(socket.gethostname()): 'bodhi'},
        'relay_inbound': ['tcp://busgateway01{{ env_suffix }}.phx2.fedoraproject.org:9941'],
{% if env == 'staging' %}
        'environment': 'stg',
        # stg should listen to the stg bus
        'endpoints': {
            'staging_gateway': ['tcp://stg.fedoraproject.org:9940']
        }
{% else %}
        'environment': 'prod',
{% endif %}
    }
