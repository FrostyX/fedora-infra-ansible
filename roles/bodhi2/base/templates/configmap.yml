---
apiVersion: v1
kind: ConfigMap
metadata:
  name: bodhi-configmap
  labels:
    app: bodhi
data:
  krb5.conf: |-
    [logging]
     default = FILE:/var/log/krb5libs.log
     kdc = FILE:/var/log/krb5kdc.log
     admin_server = FILE:/var/log/kadmind.log
    
    [libdefaults]
     default_realm = {{ ipa_realm }}
     rdns = false
     dns_canonicalize_hostname = false
     dns_lookup_realm = false
     dns_lookup_kdc = false
     ticket_lifetime = 24h
     renew_lifetime = 7d
     forwardable = true
    
    [realms]
     {{ ipa_realm }} = {
      kdc = ipa01{{ env_suffix }}.phx2.fedoraproject.org
     }
    
    [domain_realm]
     .fedoraproject.org = FEDORAPROJECT.ORG
     fedoraproject.org = FEDORAPROJECT.ORG
    {% if env == "staging" %}
     .stg.phx2.fedoraproject.org = STG.FEDORAPROJECT.ORG
    {% endif %}
     .stg.fedoraproject.org = STG.FEDORAPROJECT.ORG
     stg.fedoraproject.org = STG.FEDORAPROJECT.ORG
  production.ini: |-
    {%- macro production_ini() %}    {% include "production.ini.j2" %}{%- endmacro -%}
    {{ production_ini() | indent() }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: fedmsg-configmap
  labels:
    app: bodhi
data:
  bodhi-openshift-web.py: |-
    import socket
    hostname = socket.gethostname().split('.', 1)[0]
    config = {
        'sign_messages': True,
        'active': True,
        'cert_prefix': 'bodhi',
        'certnames': {'bodhi.{}'.format(socket.gethostname()): 'bodhi'},
        'relay_inbound': ['tcp://busgateway01{{ env_suffix }}.phx2.fedoraproject.org:9941'],
        'bodhi.%s' % hostname: ['tcp://busgateway01{{ env_suffix }}.phx2.fedoraproject.org:9941'],
{% if env == 'staging' %}
        'environment': 'stg',
        # stg should listen to the stg bus
        'endpoints': {
            'staging_gateway': ['tcp://stg.fedoraproject.org:9940']
        }
{% else %}
        'environment': 'prod',
{% endif %}
    }
