---
#
# Setup koji hub server. 
#
- name: install koji hub server packages
  yum: name={{ item }} state=installed
  with_items:
  - koji-hub
  - koji-web
  - koji-utils
  - mod_ssl
  - mod_wsgi
  - git
  - gnupg2
  tags:
  - packages

- name: make koji pki directory
  file: state=directory path=/etc/pki/koji/ owner=root group=root

- name: make koji pki subdirectories
  file: state=directory path=/etc/pki/koji/{{ item }} owner=root group=root
  with_items:
  - certs
  - private
  - confs

- name: init koji ca key file
  file: source={{ puppet_private}}/koji/koji.stg_key.pem dest=/etc/pki/koji/private/
  tags:
  - config

- name: init koji ca cert file
  file: source={{ puppet_private}}/koji/koji.stg_cert.pem dest=/etc/pki/koji/private/
  tags:
  - config

# setup certs needed here for kojiweb/hub

# Todo here
# httpd ssl.conf changes
# koji hub.conf template
#
- name: make mnt/koji directory
  file: state=directory path=/mnt/koji/ owner=root group=root

# selinux config: 
#   httpd_can_network_connect_db=1 allow_httpd_anon_write=1
#   chcon -R -t public_content_rw_t /mnt/koji/*

- name: Set httpd to run on boot
  service: name=httpd enabled=yes
  ignore_errors: true
  notify:
  - restart httpd
  tags:
  - service
