---
- name: update all
  action: command yum -y update
  tags:
  - packages
  
- name: ntpdate install
  action: yum state=installed pkg=ntpdate
  tags:
  - packages

- name: ntp install
  action: yum state=installed pkg=ntp
  tags:
  - packages

- name: put step-tickers in place
  action: copy src=$files/common/step-tickers dest=/etc/ntp/step-tickers

- name: enable the service
  action: service name=ntpd state=running enabled=true

- name: edit hostname to be instance name - prefix hostbase var if it exists
  action: shell hostname  ${hostbase}`curl -s http://169.254.169.254/latest/meta-data/instance-id`
  tags:
  - config

- name: add ansible root key 
  action: authorized_key user=root key="{{ item }}"
  with_file:
  - ${files}/common/ansible-pub-key
  tags:
  - config
  
- name: add root keys for sysadmin-main and other allowed users
  action: authorized_key user=root key="{{ item }}"
  with_pipe:
  - "${auth_keys_from_fas} @sysadmin-main ${root_auth_users}"
  tags:
  - config


# note - kinda should be a handler - but handlers need args
- name: restorecon
  action: command restorecon -R /root/.ssh
  tags:
  - config

