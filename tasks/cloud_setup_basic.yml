---
- name: put repos on system
  action: copy src=$files/common/$item dest=/etc/yum.repos.d/$item
  with_items:
  - epel6.repo
  - rhel6.repo
  only_if: '$is_rhel'
  tags:
  - config


- name: update all
  action: command yum -y update
  tags:
  - packages
  
- name: ntpdate install
  action: yum state=installed pkg=ntpdate
  tags:
  - packages
- name: sync time - just once
  action: command /usr/sbin/ntpdate -s -b 66.187.233.4

- name: edit hostname to be instance name - prefix hostbase var if it exists
  action: shell hostname  ${hostbase}`curl -s http://169.254.169.254/latest/meta-data/instance-id`
  tags:
  - config

- name: add ansible root key 
  action: authorized_key user=root key='$FILE(${files}/common/ansible-pub-key)'
  tags:
  - config
  
- name: add root keys for sysadmin-main and other allowed users
  action: authorized_key user=root key='$PIPE(${auth_keys_from_fas} @sysadmin-main ${root_auth_users})'
  tags:
  - config


# note - kinda should be a handler - but handlers need args
- name: restorecon
  action: command restorecon -R /root/.ssh
  tags:
  - config

- name: put /dev/vda2 up as /mnt
  action: mount name=/mnt src=/dev/vda2 fstype=ext3 passno=1 dump=1 state=mounted

